{% extends 'dreams/base.html' %}
{% load static %}

{% block main %}
<div class="main-content">
    <div class="section__content section__content--p30">
        <div class="container-fluid">


          <div class="row">

            <div class="col-lg-8">
                <div class="au-card m-b-30">
                    <div class="au-card-inner">
                        <h3 class="title-2 m-b-40">Dreams map</h3>

                    </div>
                </div>
            </div>

            <div class="col-lg-4" style="padding-left: 10px; padding-right: 10px;">
                <div class="au-card m-b-30" style="padding-left: 20px;">
                    <div class="au-card-inner">
                        <h3 class="title-2 m-b-40">Interaction words</h3>
                        <div class="chart-wrapper" id="bar_chart"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4" style="padding-left: 10px; padding-right: 10px;">
                <div class="au-card m-b-30" style="padding-left: 20px;">
                    <div class="au-card-inner">
                        <h3 class="title-2 m-b-40">Interaction words</h3>

                    </div>
                </div>
            </div>

              <div class="col-lg-12" style="padding-left: 10px; padding-right: 10px;">
                  <div class="au-card m-b-30" style="padding-left: 20px;">
                      <div class="au-card-inner">
                          <h3 class="title-2 m-b-40">Interaction words</h3>
                          <div class="chart-wrapper" id="tsne_chart"></div>
                      </div>
                  </div>
              </div>

          </div>


        </div>
    </div>
</div>
{% endblock main %}

{% block d3js %}
<!-- TSNE CHART -->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="{% static 'dreams/js/tsneChart.js' %}"></script>
<script>
// AJOUTER LEGENDE COULEUR
  let d3v4 = d3
	const w = 300;
	const h = 300;
	const leg_w = 150;
	const leg_h = 100;
	let x;
	let y;
	let dataset = [];
	let on_word;

	// Append SVG
	let svg = d3v4.select("#tsne_chart")
				.append("svg")
				.attr("width", w)
				.attr("height", h)
				.call(d3v4.zoom().on("zoom", function () {
    			svg.attr("transform", d3v4.event.transform)
	 			}))
				.append("g");

var tabeau_legendes = [{'type' : "Verb", 'color' : "#c300ff"},
 									 		{'type' : "Noun", 'color' : "#009b31"},
											{'type' : "Adverb", 'color' : "#ff0000"},
											{'type' : "Other", 'color' : "#f4df41"},
											{'type' : "Adjective", 'color' : "#0008ff"}]

var tooltip = d3v4.select("#tsne_chart")
			    .append("div")
			    .style("position", "absolute")
			    .style("z-index", "10")
			    .style("visibility", "hidden")
			    .style("opacity", "0.8")
			    .style("padding","10px")
			    .style("border-radius","2px")
			    .style("background-color", "black")
					.style("color", "white");

// Loading csv file
d3v4.csv("{% static 'dreams/data/coord_2D.csv' %}").row( (d, i) => {
		  return {
		    word : d.word,
				tag : d.tag,
		    x_coord : +d.x_coord,
		    y_coord : +d.y_coord,
		    //z_coord : +d.z_coord,
				count : +d.count,
				frequence : +d.frequence,
				opacity : +d.opacity
		  };
		})
		.get((error, rows) => {
			console.log("Loaded " + rows.length + " words");
		  console.log(rows[0]);
		  console.log(rows[20]);

		 dataset = rows;

			x = d3v4.scaleLinear()
			      .domain(d3v4.extent(rows,(row) => row.x_coord))
			      .range([0, w]);

			y = d3v4.scaleLinear()
			      .domain(d3v4.extent(rows,(row) => row.y_coord))
			      .range([0, h]);

		  	draw();
				draw_legend();
		});
</script>


<!-- BARCHART -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/datamaps/0.5.8/datamaps.all.js"></script>
<script src="{% static 'dreams/js/barChart.js' %}"></script>
{% endblock d3js %}
